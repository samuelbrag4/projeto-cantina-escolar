<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <title>Gestão de Estoque</title>
    <link rel="stylesheet" href="/style.css">
</head>

<body>
    <header>
        <h2>Gestão de Estoque da Cantina Escolar</h2>
        <nav>
            <a href="/dashboard">Dashboard</a> |
            <a href="/cadastro-produto">Produtos</a> |
            <a href="/logout">Sair</a>
        </nav>
    </header>

    <main>
        <section>
            <h3>Registrar venda</h3>
            <form action="/gestao-estoque" method="POST" class="form-mov">
                <select name="product_id" required>
                    <option value="">Selecione o produto</option>
                    <% produtos.forEach(p=> { %>
                        <option value="<%= p.id %>">
                            <%= p.nome %> (Estoque: <%= p.quantidade %>)
                        </option>
                    <% }) %>
                </select>

                <select name="type" required>
                    <option value="entrada">Entrada</option>
                    <option value="saida">Saída</option>
                </select>

                <input type="number" name="quantity" min="1" placeholder="Quantidade" required>
                <input type="date" name="movement_date" value="<%= new Date().toISOString().slice(0,10) %>" required>
                <input type="text" name="note" placeholder="Observação (opcional)">
                <button type="submit">Registrar</button>
            </form>
        </section>

        <section>
            <h3>Últimas vendas</h3>
            <table>
                <thead>
                    <tr>
                        <th>Produto</th>
                        <th>Funcionário</th>
                        <th>Qtd</th>
                        <th>Preço Total</th>
                    </tr>
                </thead>
                <tbody>
                    <% if (!movimentos || movimentos.length === 0) { %>
                        <tr><td colspan="4">Nenhuma movimentação recente.</td></tr>
                    <% } else { %>
                        <% movimentos.forEach(m => { %>
                            <tr>
                                <td><%= m.produto %></td>
                                <td><%= m.funcionario %></td>
                                <td><%= m.quantidade %></td>
                                <td>R$ <%= Number(m.preco_total).toFixed(2) %></td>
                            </tr>
                        <% }) %>
                    <% } %>
                </tbody>
            </table>
        </section>
    </main>
</body>

</html>